(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const G="modulepreload",Y=function(t){return"/kiosk/"+t},$={},W=function(e,n,s){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");r=Promise.allSettled(n.map(c=>{if(c=Y(c),c in $)return;$[c]=!0;const d=c.endsWith(".css"),y=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${y}`))return;const g=document.createElement("link");if(g.rel=d?"stylesheet":G,d||(g.as="script"),g.crossOrigin="",g.href=c,a&&g.setAttribute("nonce",a),document.head.appendChild(g),d)return new Promise((C,V)=>{g.addEventListener("load",C),g.addEventListener("error",()=>V(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})},N={en:{incomingCase:"Incoming Cases",noActiveCases:"No Active Cases",activeSystemMessage:"System is active and monitoring incoming cases"},de:{incomingCase:"Eingehende F√§lle",noActiveCases:"Keine aktiven F√§lle",activeSystemMessage:"Das System ist aktiv und √ºberwacht eingehende F√§lle"}};class j{constructor(){this.supportedLanguages=["en","de"],this.currentLanguage=this.detectLanguage()}detectLanguage(){const e=localStorage.getItem("language");return e&&this.supportedLanguages.includes(e)?e:(navigator.language||navigator.userLanguage).substring(0,2).toLowerCase()==="de"?"de":"en"}getCurrentLanguage(){return this.currentLanguage}setLanguage(e){return this.supportedLanguages.includes(e)?(this.currentLanguage=e,localStorage.setItem("language",e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:e}})),!0):!1}getSupportedLanguages(){return[...this.supportedLanguages]}t(e){return(N[this.currentLanguage]||N.en)[e]||e}toggleLanguage(){const e=this.currentLanguage==="en"?"de":"en";return this.setLanguage(e)}getLanguageDisplayName(e=null){const n=e||this.currentLanguage;return{en:"English",de:"Deutsch"}[n]||n}formatDateTime(e){const n=this.currentLanguage==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(n,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(e)}formatTime(e){const n=this.currentLanguage==="de"?"de-DE":"en-US";return new Intl.DateTimeFormat(n,{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(e)}}const E=new j,p=t=>E.t(t),l={caseSharingUrl:"https://case-sharing-564499947017.europe-west3.run.app",pwaUrl:"https://igfap.eu/0925/",pollInterval:5e3,autoArchiveHours:2,staleGpsMinutes:5,hospitalId:(()=>{const t=localStorage.getItem("kiosk_hospital_id");return t===null||t===""?null:t})(),hospitalName:localStorage.getItem("kiosk_hospital_name")||"LMU Klinikum M√ºnchen - Gro√ühadern",googleMapsApiKey:(()=>{try{}catch{}return""})(),playAudioAlert:!0,audioAlertVolume:.5,showArchivedCases:!1,maxCasesDisplay:20,theme:"dark"},z=[{id:"BY-NS-001",name:"LMU Klinikum M√ºnchen - Gro√ühadern"},{id:"BY-NS-002",name:"Klinikum Rechts der Isar"},{id:"BY-NS-003",name:"Helios Klinikum M√ºnchen West"},{id:"BY-NS-004",name:"Klinikum Bogenhausen"},{id:"BW-NS-001",name:"Universit√§tsklinikum T√ºbingen"},{id:"BW-NS-005",name:"Klinikum Stuttgart - Katharinenhospital"},{id:"BW-NS-003",name:"Universit√§tsklinikum Freiburg"},{id:"ALL",name:"üåê All Hospitals (Show All Cases)"}];function q(t){const e=z.find(n=>n.id===t);e&&(t==="ALL"?(localStorage.setItem("kiosk_hospital_id",""),localStorage.setItem("kiosk_hospital_name",e.name)):(localStorage.setItem("kiosk_hospital_id",t),localStorage.setItem("kiosk_hospital_name",e.name)),l.hospitalId=t==="ALL"?null:t,l.hospitalName=e.name,window.location.reload())}const L={IMMEDIATE:{color:"#ff4444",icon:"üö®",priority:0},TIME_CRITICAL:{color:"#ff8800",icon:"‚è∞",priority:1},URGENT:{color:"#ffcc00",icon:"‚ö†Ô∏è",priority:2},STANDARD:{color:"#4a90e2",icon:"üè•",priority:3}},I={encryptionKey:(()=>{try{}catch{}return null})(),enabled:!0},Q=Object.freeze(Object.defineProperty({__proto__:null,AVAILABLE_HOSPITALS:z,ENCRYPTION_CONFIG:I,KIOSK_CONFIG:l,URGENCY_CONFIG:L,setHospital:q},Symbol.toStringTag,{value:"Module"})),f={NEW_CASE_VIEWED_DELAY_MS:2e3,ALERT_BEEP_DURATION_SEC:.5,ALERT_BEEP_FREQUENCY_HZ:880,ALERT_BEEP_VOLUME:.5,FETCH_TIMEOUT_MS:8e3,MAX_RETRY_ATTEMPTS:3,RETRY_DELAYS_MS:[2e3,4e3,8e3],CASE_STALE_THRESHOLD_MINUTES:30};function X(t){return t>70?"#ff4444":t>50?"#ff8800":t>30?"#ffcc00":"#4a90e2"}function Z(t){return t.updatedAt?t.updatedAt:t.lastUpdated?t.lastUpdated:t.tracking?.lastUpdated?t.tracking.lastUpdated:t.createdAt||new Date}function J(t){const e=new Date;let n=t instanceof Date?t.toISOString():String(t);typeof t=="string"&&!/Z$/.test(n)&&!/[+-]\d{2}:\d{2}$/.test(n)&&(n+="Z");const s=new Date(n);if(isNaN(s.getTime()))return"Unknown";const r=Math.max(0,Math.floor((e-s)/1e3));if(r<60)return`${r}s ago`;const i=Math.floor(r/60);return i<60?`${i}m ago`:`${Math.floor(i/60)}h ${i%60}m ago`}function ee(t){if(t==null||t==="?")return"?";const e=typeof t=="string"?parseFloat(t):t;return isNaN(e)?"?":e<=0?"Arrived":e<1?"< 1":Math.round(e).toString()}function te(t,e=5){if(!t)return!0;try{const n=new Date(t);return isNaN(n.getTime())?!0:(new Date-n)/(1e3*60)>e}catch{return!0}}function ne(t,e=f.CASE_STALE_THRESHOLD_MINUTES){if(!t)return!1;try{const n=t instanceof Date?t:new Date(t);return isNaN(n.getTime())?!1:(new Date-n)/(1e3*60)>e}catch{return!1}}function re(t){return!(!t||typeof t!="object"||!t.id||typeof t.id!="string")}function se(t){if(typeof AbortSignal<"u"&&AbortSignal.timeout)return AbortSignal.timeout(t);const e=new AbortController,n=setTimeout(()=>{e.abort(new Error(`Timeout after ${t}ms`))},t);return e.signal.addEventListener("abort",()=>{clearTimeout(n)},{once:!0}),e.signal}function ie(t){return new Promise(e=>setTimeout(e,t))}const T="AES-GCM",oe=256,ae=12,A=128;class ce{constructor(){this.key=null,this.initialized=!1}async init(e){if(!e){console.warn("[CryptoService] No encryption key provided - encryption disabled");return}try{const n=Uint8Array.from(atob(e),s=>s.charCodeAt(0));if(n.length!==32)throw new Error(`Invalid key length: ${n.length} bytes (expected 32)`);this.key=await crypto.subtle.importKey("raw",n,{name:T,length:oe},!1,["encrypt","decrypt"]),this.initialized=!0,console.log("[CryptoService] Initialized successfully (direct key import)")}catch(n){console.error("[CryptoService] Initialization failed:",n),this.initialized=!1}}isEnabled(){return this.initialized&&this.key!==null}async encrypt(e){if(!this.initialized)throw new Error("CryptoService not initialized");const n=crypto.getRandomValues(new Uint8Array(ae)),s=new TextEncoder().encode(typeof e=="string"?e:JSON.stringify(e)),r=await crypto.subtle.encrypt({name:T,iv:n,tagLength:A},this.key,s),i=new Uint8Array(r),o=i.length-A/8,a=i.slice(0,o),c=i.slice(o);return{v:2,alg:"AES-256-GCM",iv:this._toBase64(n),ct:this._toBase64(a),tag:this._toBase64(c)}}async decrypt(e){if(!this.initialized)throw new Error("CryptoService not initialized");if(!e||!e.v||e.v<2)return e;try{const n=this._fromBase64(e.iv),s=this._fromBase64(e.ct),r=this._fromBase64(e.tag),i=new Uint8Array(s.length+r.length);i.set(s),i.set(r,s.length);const o=await crypto.subtle.decrypt({name:T,iv:n,tagLength:A},this.key,i),a=new TextDecoder().decode(o);try{return JSON.parse(a)}catch{return a}}catch(n){throw console.error("[CryptoService] Decryption failed:",n),new Error("Decryption failed - invalid key or corrupted data")}}async encryptFields(e,n){if(!this.initialized)return console.warn("[CryptoService] Not initialized - returning unencrypted"),e;const s={...e},r=[];for(const i of n)s[i]!==void 0&&(s[`_enc_${i}`]=await this.encrypt(s[i]),delete s[i],r.push(i));return r.length>0&&(s._encrypted=!0,s._encFields=r,s._encVersion=2),s}async decryptFields(e){if(!e||!e._encrypted)return e;if(!this.initialized)throw console.error("[CryptoService] Cannot decrypt - not initialized"),new Error("CryptoService not initialized");const n={...e},s=e._encFields||[];for(const r of s){const i=`_enc_${r}`;if(n[i])try{n[r]=await this.decrypt(n[i]),delete n[i]}catch(o){console.error(`[CryptoService] Failed to decrypt field ${r}:`,o)}}return delete n._encrypted,delete n._encFields,delete n._encVersion,n}async encryptRequest(e,n){return this.initialized?{encrypted:await this.encrypt(e),moduleType:n,_v:2}:e}async decryptResponse(e){if(!e||!e.encrypted)return e;if(!this.initialized)throw new Error("Cannot decrypt response - CryptoService not initialized");return await this.decrypt(e.encrypted)}_toBase64(e){return btoa(String.fromCharCode(...new Uint8Array(e)))}_fromBase64(e){return Uint8Array.from(atob(e),n=>n.charCodeAt(0))}}const M=new ce;class le{constructor(){this.baseUrl=l.caseSharingUrl,this.pollInterval=l.pollInterval,this.intervalId=null,this.cases=new Map,this.onUpdate=null,this.onError=null,this.lastFetchTime=null,this.isConnected=!1,this.retryCount=0}start(e,n){this.onUpdate=e,this.onError=n,this.fetchCases(),this.intervalId=setInterval(()=>{this.fetchCases()},this.pollInterval),console.log("[CaseListener] Started polling every",this.pollInterval,"ms")}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null,console.log("[CaseListener] Stopped polling"))}async fetchCases(){let e=null;for(let n=0;n<=f.MAX_RETRY_ATTEMPTS;n++)try{const s=this.buildFetchUrl(),r=await fetch(s,{method:"GET",headers:{Accept:"application/json"},signal:se(f.FETCH_TIMEOUT_MS)});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const i=await r.json();if(!i.success)throw new Error(i.error||"Failed to fetch cases");this.retryCount=0,this.isConnected=!0,this.lastFetchTime=new Date,await this.processCases(i.cases||[]),this.onUpdate&&this.onUpdate({cases:Array.from(this.cases.values()),timestamp:i.timestamp,count:i.count});return}catch(s){if(e=s,console.error(`[CaseListener] Fetch error (attempt ${n+1}/${f.MAX_RETRY_ATTEMPTS+1}):`,s),n<f.MAX_RETRY_ATTEMPTS){const r=f.RETRY_DELAYS_MS[n]||8e3;console.log(`[CaseListener] Retrying in ${r}ms...`),await ie(r)}}console.error("[CaseListener] All retry attempts failed:",e),this.isConnected=!1,this.retryCount++,this.onError&&this.onError(e)}buildFetchUrl(){let e=`${this.baseUrl}/get-cases`;const n=new URLSearchParams;l.hospitalId&&l.hospitalId!=="ALL"&&n.append("hospitalId",l.hospitalId),n.append("status","pending");const s=n.toString();return s&&(e+=`?${s}`),e}async processCases(e){const n=new Set(this.cases.keys()),s=new Set;for(const r of e){let i=r;if(M.isEnabled()&&r._encrypted)try{i=await M.decryptFields(r),console.log("[CaseListener] Case decrypted:",r.id)}catch(y){console.error("[CaseListener] Decryption failed for case:",r.id,y);continue}if(!re(i)){console.warn("[CaseListener] Invalid case data, skipping:",i);continue}const o=i.id;s.add(o);const a=!this.cases.has(o),c=te(i.tracking?.lastUpdated,l.staleGpsMinutes),d={...i.tracking||{},gpsStale:c};this.cases.set(o,{...i,tracking:d,isNew:a,receivedAt:a?new Date:this.cases.get(o).receivedAt}),a&&(console.log("[CaseListener] New case:",o,this.getCaseSummary(i)),console.log("[CaseListener] Timestamps:",{createdAt:i.createdAt,updatedAt:i.updatedAt,receivedAt:i.receivedAt,trackingLastUpdated:i.tracking?.lastUpdated}))}n.forEach(r=>{s.has(r)||(console.log("[CaseListener] Case removed:",r),this.cases.delete(r))})}getCaseSummary(e){const n=Math.round((e.results?.ich?.probability||0)*100),s=e.tracking?.duration||"?";return{module:e.moduleType,ich:`${n}%`,eta:`${s} min`,urgency:e.urgency}}getCases(){return Array.from(this.cases.values())}getCase(e){return this.cases.get(e)}markViewed(e){const n=this.cases.get(e);n&&(n.isNew=!1,this.cases.set(e,n))}async dismissCase(e){try{const n=`${this.baseUrl}/archive-case`,s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({caseId:e,reason:"dismissed_by_kiosk"}),signal:AbortSignal.timeout(8e3)});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json();if(!r.success)throw new Error(r.error||"Failed to dismiss case");return this.cases.delete(e),console.log("[CaseListener] Case dismissed:",e),this.onUpdate&&this.onUpdate({cases:Array.from(this.cases.values()),timestamp:new Date().toISOString(),count:this.cases.size}),r}catch(n){throw console.error("[CaseListener] Dismiss error:",n),n}}getStatus(){return{isConnected:this.isConnected,lastFetchTime:this.lastFetchTime,caseCount:this.cases.size,isPolling:this.intervalId!==null}}}const m=new le;function de(t){const e=document.getElementById("casesContainer");if(!e)return;if(!t||t.length===0){e.innerHTML=`
      <div class="flex flex-col items-center justify-center text-center py-16 text-gray-500 dark:text-gray-300">
        <div class="text-6xl mb-4">‚úì</div>
        <h2 class="text-xl font-semibold mb-2">${p("noActiveCases")}</h2>
        <p class="text-sm">${p("activeSystemMessage")}</p>
      </div>
    `;return}const n=ue(t),r=n.slice(0,l.maxCasesDisplay).map(he).join(""),i=n.length>l.maxCasesDisplay?`
        <div class="text-center text-amber-600 dark:text-amber-400 text-sm mb-4" role="alert">
          Showing ${l.maxCasesDisplay} of ${n.length} cases
        </div>`:"";e.innerHTML=`
    ${i}
    <div class="grid gap-6 px-6 sm:px-3 pb-8 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
      ${r}
    </div>
  `}function ue(t){return[...t].sort((e,n)=>{const s=L[e.urgency]?.priority??10,r=L[n.urgency]?.priority??10;if(s!==r)return s-r;const i=e.tracking?.duration||9999,o=n.tracking?.duration||9999;return i-o})}function ge(t){if(!t)return"PAT-0000";let e=0;for(let s=0;s<t.length;s++)e=(e<<5)-e+t.charCodeAt(s),e|=0;return`PAT-${Math.abs(e%1e4).toString().padStart(4,"0")}`}function he(t){const e=L[t.urgency]||L.STANDARD,n=Math.round((t.results?.ich?.probability||0)*100),s=t.results?.lvo?Math.round(t.results.lvo.probability*100):null,r=ee(t.tracking?.duration),i=t.tracking?.distance??"?",o=t.tracking?.gpsStale||!1,a=Z(t);ne(a);const c=J(a),d=t.cityCode||ge(t.id),y=`${t.urgency} case, ${d}, ICH risk ${n}%, ETA ${r} minutes`;function g(C){switch(C.toLowerCase()){case"coma":return"bg-blue-100 text-blue-700 dark:bg-blue-800 dark:text-blue-100";case"full":return"bg-purple-100 text-purple-700 dark:bg-purple-800 dark:text-purple-100";default:return"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-200"}}return`
    <div
      class="case-card relative flex flex-col border-2 rounded-xl shadow-md overflow-hidden 
             transition-all duration-300 cursor-pointer focus:ring-2 focus:ring-blue-500 outline-none 
             bg-gray-500 dark:bg-gray-800 hover:scale-[1.02] hover:shadow-lg
             ${t.urgency.toLowerCase()==="critical"?"border-red-500":""}
             ${t.urgency.toLowerCase()==="high"?"border-orange-500":""}
             ${t.urgency.toLowerCase()==="moderate"?"border-yellow-400":""}
             ${t.urgency.toLowerCase()==="low"?"border-green-500":""}
             ${t.isNew?"ring-2 ring-blue-400 animate-pulse":""}
             "
      data-case-id="${t.id}"
      style="border-color: ${e.color};"
      role="listitem"
      tabindex="0"
      aria-label="${y}"
    >

      <!-- Header -->
      <div class="bg-gray-900 text-white flex items-center justify-between px-4 py-2">
        <div class="flex items-center gap-2 font-semibold text-sm tracking-wide">
          ${e.icon} ${t.urgency}
        </div>
        <div class="text-xs flex items-center gap-3 opacity-90">
          <span class="font-mono ${t.cityCode?"text-sm font-bold tracking-wider":""}">${d}</span>
       <span class="px-2 py-0.5 text-[11px] font-semibold rounded-full uppercase tracking-wide ${g(t.moduleType)}">
  ${t.moduleType}
</span>

        </div>
      </div>

      <!-- City Code Banner -->
      ${t.cityCode?`
      <div class="flex flex-col items-center justify-center py-3 bg-gradient-to-r from-blue-800 to-blue-600 text-white">
        <span class="text-[10px] uppercase tracking-[0.2em] opacity-60">Patient-Code</span>
        <span class="text-2xl font-black tracking-wider leading-tight">${t.cityCode}</span>
      </div>
      `:""}

      <!-- Risk Section -->
      <div class="flex items-center justify-center gap-6 py-4 bg-blue-200 dark:bg-gray-800">
        <div class="flex justify-center items-center">
          ${U(n,"ICH")}
        </div>
        ${s!==null?`<div class="flex justify-center items-center">${U(s,"LVO")}</div>`:""}
      </div>

      <!-- ETA Section -->
      <div class="flex flex-col items-center justify-center py-3 bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200">
        <div class="flex items-end gap-1 text-2xl font-bold ${o?"text-yellow-500":"text-blue-600 dark:text-blue-400"}">
          <span>${r}</span>
          <span class="text-sm font-medium">
            ${r==="Arrived"||r==="?"?"":"min"}
          </span>
        </div>
        <div class="text-xs mt-1 flex items-center gap-2 text-gray-600 dark:text-gray-400">
          <span>${typeof i=="number"?i.toFixed(1):i} km</span>
          ${o?'<span class="text-yellow-600 dark:text-yellow-400 font-semibold" role="alert">‚ö†Ô∏è GPS stale</span>':""}
        </div>
      </div>

      <!-- Footer -->
      <div class="flex items-center justify-between text-xs px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300">
        <span>${c}</span>
        <span class="text-blue-600 dark:text-blue-400 font-semibold hover:underline">View Details ‚Üí</span>
      </div>
    </div>
  `}function U(t,e){const n=X(t),s=Math.PI*100,r=s*(1-t/100);return`
    <div class="flex flex-col items-center">
      <svg class="w-20 h-20 ${t>70?"text-red-500":t>50?"text-orange-500":t>30?"text-yellow-400":"text-green-500"}" viewBox="0 0 120 120">
        <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(255,255,255,0.15)" stroke-width="8"/>
        <circle
          cx="60"
          cy="60"
          r="50"
          fill="none"
          stroke="${n}"
          stroke-width="8"
          stroke-dasharray="${s}"
          stroke-dashoffset="${r}"
          stroke-linecap="round"
          transform="rotate(-90 60 60)"/>
        <text x="60" y="65" text-anchor="middle" class="font-bold text-lg fill-black dark:fill-white">
          ${t}%
        </text>
      </svg>
      <div class="text-xs mt-1 uppercase tracking-wide text-gray-600 dark:text-gray-300">${e}</div>
    </div>
  `}const w={MEDIUM:"medium",HIGH:"high",CRITICAL:"critical"},h={NETWORK:"network",VALIDATION:"validation",AUTHENTICATION:"authentication",CALCULATION:"calculation",RENDERING:"rendering",MEDICAL:"medical"};class fe extends Error{constructor(e,n,s=h.MEDICAL,r=w.MEDIUM){super(e),this.name="MedicalError",this.code=n,this.category=s,this.severity=r,this.timestamp=new Date().toISOString(),this.context={}}withContext(e){return this.context={...this.context,...e},this}getUserMessage(){switch(this.category){case h.NETWORK:return"Network connection issue. Please check your internet connection and try again.";case h.VALIDATION:return"Please check your input data and try again.";case h.AUTHENTICATION:return"Authentication failed. Please log in again.";case h.CALCULATION:return"Unable to complete calculation. Please verify your input data.";case h.MEDICAL:return"Medical calculation could not be completed. Please verify all clinical data.";default:return"An unexpected error occurred. Please try again."}}}class me{constructor(){this.errorQueue=[],this.maxQueueSize=100,this.setupGlobalHandlers()}setupGlobalHandlers(){window.addEventListener("unhandledrejection",e=>{this.handleError(e.reason,h.NETWORK,w.HIGH),e.preventDefault()}),window.addEventListener("error",e=>{this.handleError(e.error,h.RENDERING,w.MEDIUM)})}handleError(e,n=h.NETWORK,s=w.MEDIUM){const r={error:e instanceof Error?e:new Error(String(e)),category:n,severity:s,timestamp:new Date().toISOString(),userAgent:navigator.userAgent.substring(0,100),url:window.location.href};this.errorQueue.push(r),this.errorQueue.length>this.maxQueueSize&&this.errorQueue.shift(),s===w.CRITICAL&&this.handleCriticalError(r)}handleCriticalError(e){e.category===h.MEDICAL&&this.showMedicalAlert(e.error.message)}showMedicalAlert(e){const n=document.createElement("div");n.className="critical-medical-alert",n.style.cssText=`
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #ff4444;
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      z-index: 10000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      max-width: 90%;
      text-align: center;
    `,n.textContent=`‚ö†Ô∏è Medical Error: ${e}`,document.body.appendChild(n),setTimeout(()=>{document.body.contains(n)&&document.body.removeChild(n)},1e4)}getErrorSummary(){return{totalErrors:this.errorQueue.length,criticalErrors:this.errorQueue.filter(e=>e.severity===w.CRITICAL).length,recentErrors:this.errorQueue.slice(-10)}}}const pe=new me;async function ye(t,e={}){const{category:n=h.NETWORK,severity:s=w.MEDIUM,fallback:r=null,timeout:i=3e4,retries:o=0,context:a={}}=e;for(let c=0;c<=o;c++)try{const d=new Promise((g,C)=>{setTimeout(()=>C(new Error("Operation timeout")),i)});return await Promise.race([t(),d])}catch(d){if(pe.handleError(d,n,s),c<o){await new Promise(g=>setTimeout(g,1e3*(c+1)));continue}if(r!==null)return typeof r=="function"?r(d):r;throw new fe(d.message||"Operation failed",d.code||"UNKNOWN",n,s).withContext(a)}}let v=[],u=null,k=null,x=!0;async function R(){if(console.log("[Kiosk] Initializing...",l),I.encryptionKey)try{await M.init(I.encryptionKey),console.log("[Kiosk] End-to-end encryption initialized")}catch(t){console.warn("[Kiosk] Encryption initialization failed:",t.message)}else console.log("[Kiosk] Encryption disabled or no key configured");Te(),Ae(),H(),k=setInterval(H,1e3),be(),m.start(t=>Le(t),t=>ke(t)),Me(),window.addEventListener("beforeunload",Ce),console.log("[Kiosk] Initialized successfully"),we()}function we(){setTimeout(()=>{const t=localStorage.getItem("language")||"en",e=document.getElementById("languageToggle");e&&(e.innerHTML=t==="en"?P():K(),e.addEventListener("click",ve),console.log("[Kiosk] Language toggle ready"))},200)}function ve(){ye(async()=>{E.toggleLanguage(),Ee()},t=>console.warn("[Kiosk] Language toggle failed",t))}function S(t,e){const n=document.getElementById(t);n&&(n.title=e,n.setAttribute("aria-label",e))}function Ee(){document.documentElement.lang=E.getCurrentLanguage(),b(".app-header h1",p("appTitle")),b(".emergency-badge",p("emergencyBadge")),S("languageToggle",p("languageToggle")),S("helpButton",p("helpButton")),S("darkModeToggle",p("darkModeButton")),b("#modalTitle",p("helpTitle")),E.updateUI&&E.updateUI();const t=document.getElementById("languageToggle");if(t){const e=E.getCurrentLanguage();t.innerHTML=e==="en"?P():K()}}function P(){return` <svg
              width="20px"
              height="20px"
              viewBox="0 0 36 36"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              aria-hidden="true"
              role="img"
              class="iconify iconify--twemoji"
              preserveAspectRatio="xMidYMid meet"
            >
              <path fill="#FFCD05" d="M0 27a4 4 0 0 0 4 4h28a4 4 0 0 0 4-4v-4H0v4z"></path>
              <path fill="#ED1F24" d="M0 14h36v9H0z"></path>
              <path fill="#141414" d="M32 5H4a4 4 0 0 0-4 4v5h36V9a4 4 0 0 0-4-4z"></path>
            </svg>`}function K(){return'<svg width="20px" height="20px" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--twemoji" preserveAspectRatio="xMidYMid meet"><path fill="#00247D" d="M0 9.059V13h5.628zM4.664 31H13v-5.837zM23 25.164V31h8.335zM0 23v3.941L5.63 23zM31.337 5H23v5.837zM36 26.942V23h-5.631zM36 13V9.059L30.371 13zM13 5H4.664L13 10.837z"></path><path fill="#CF1B2B" d="M25.14 23l9.712 6.801a3.977 3.977 0 0 0 .99-1.749L28.627 23H25.14zM13 23h-2.141l-9.711 6.8c.521.53 1.189.909 1.938 1.085L13 23.943V23zm10-10h2.141l9.711-6.8a3.988 3.988 0 0 0-1.937-1.085L23 12.057V13zm-12.141 0L1.148 6.2a3.994 3.994 0 0 0-.991 1.749L7.372 13h3.487z"></path><path fill="#EEE" d="M36 21H21v10h2v-5.836L31.335 31H32a3.99 3.99 0 0 0 2.852-1.199L25.14 23h3.487l7.215 5.052c.093-.337.158-.686.158-1.052v-.058L30.369 23H36v-2zM0 21v2h5.63L0 26.941V27c0 1.091.439 2.078 1.148 2.8l9.711-6.8H13v.943l-9.914 6.941c.294.07.598.116.914.116h.664L13 25.163V31h2V21H0zM36 9a3.983 3.983 0 0 0-1.148-2.8L25.141 13H23v-.943l9.915-6.942A4.001 4.001 0 0 0 32 5h-.663L23 10.837V5h-2v10h15v-2h-5.629L36 9.059V9zM13 5v5.837L4.664 5H4a3.985 3.985 0 0 0-2.852 1.2l9.711 6.8H7.372L.157 7.949A3.968 3.968 0 0 0 0 9v.059L5.628 13H0v2h15V5h-2z"></path><path fill="#CF1B2B" d="M21 15V5h-6v10H0v6h15v10h6V21h15v-6z"></path></svg>'}function b(t,e){const n=document.querySelector(t);n&&(n.textContent=e)}function Ce(){console.log("[Kiosk] Cleaning up resources..."),m.stop(),k&&(clearInterval(k),k=null),u&&u.state!=="closed"&&u.close().catch(t=>{console.warn("[Kiosk] Error closing audio context:",t)})}function Le(t){const e=v.length;v=t.cases||[],console.log("[Kiosk] Cases updated:",{count:v.length,previous:e}),de(v),Se(t);const n=v.filter(s=>s.isNew);n.length>0&&!x&&(F(),Ie(),setTimeout(()=>{n.forEach(s=>m.markViewed(s.id))},f.NEW_CASE_VIEWED_DELAY_MS)),x&&(x=!1),D(!0)}function ke(t){if(console.error("[Kiosk] Error:",t),D(!1),v.length===0){const e=document.getElementById("casesContainer");e&&(e.innerHTML=`
        <div class="error-state">
          <div class="error-icon">‚ö†Ô∏è</div>
          <h2>Verbindungsfehler / Connection Error</h2>
          <p>${t.message||"Unable to connect to case monitoring system"}</p>
          <p class="error-hint">Checking again in ${l.pollInterval/1e3} seconds...</p>
        </div>
      `)}}function Te(){const t=document.getElementById("hospitalSelector");t&&W(async()=>{const{AVAILABLE_HOSPITALS:e,setHospital:n}=await Promise.resolve().then(()=>Q);return{AVAILABLE_HOSPITALS:e,setHospital:n}},void 0).then(({AVAILABLE_HOSPITALS:e,setHospital:n})=>{const s=l.hospitalId||"ALL",r=[{id:"ALL",name:"üåê All Hospitals (Show All Cases)"},...e.filter(i=>i.id!=="ALL")];t.innerHTML=r.map(i=>`
      <option value="${i.id}">
        ${i.name}
      </option>
    `).join(""),t.value=s,t.value||(t.value="ALL"),t.addEventListener("change",i=>{const o=i.target.value;confirm(`Switch to ${i.target.options[i.target.selectedIndex].text}?

This will reload the page.`)?n(o):t.value=s})})}function Ae(){const t=localStorage.getItem("kiosk_theme")||l.theme;O(t);const e=document.getElementById("themeToggle");e&&e.addEventListener("click",xe),console.log("[Kiosk] Theme initialized:",t)}function xe(){const n=document.documentElement.classList.toggle("dark")?"dark":"light";localStorage.setItem("kiosk_theme",n),O(n),console.log("[Kiosk] Theme switched to:",n)}function O(t){const e=document.documentElement;t==="dark"?e.classList.add("dark"):e.classList.remove("dark");const n=document.querySelector(".theme-icon");n&&(n.textContent=t==="dark"?"‚òÄÔ∏è":"üåô")}function Se(t){const e=document.getElementById("caseCount");if(e){const n=t.count||0;e.textContent=`${n} ${n===1?"Case":"Cases"}`,e.className=`case-count-badge ${n>0?"has-cases":""}`}}function D(t){const e=document.getElementById("connectionStatus");e&&(e.className=`status-indicator ${t?"connected":"disconnected"}`,e.title=t?"Connected":"Disconnected",e.setAttribute("aria-label",`Connection status: ${t?"connected":"disconnected"}`))}function H(){const t=document.getElementById("currentTime");if(t){const e=new Date;t.textContent=e.toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}}function be(){document.addEventListener("click",()=>{u||(u=new(window.AudioContext||window.webkitAudioContext),console.log("[Kiosk] Audio initialized"))},{once:!0})}async function F(){if(u)try{u.state==="suspended"&&(await u.resume(),console.log("[Kiosk] Audio context resumed"));const t=u.createOscillator(),e=u.createGain();t.connect(e),e.connect(u.destination),t.frequency.value=f.ALERT_BEEP_FREQUENCY_HZ,t.type="sine",e.gain.setValueAtTime(f.ALERT_BEEP_VOLUME,u.currentTime),e.gain.exponentialRampToValueAtTime(.01,u.currentTime+f.ALERT_BEEP_DURATION_SEC),t.start(u.currentTime),t.stop(u.currentTime+f.ALERT_BEEP_DURATION_SEC),console.log("[Kiosk] Alert sound played")}catch(t){console.warn("[Kiosk] Audio playback failed:",t)}}function Ie(){document.body.classList.add("flash-alert"),setTimeout(()=>{document.body.classList.remove("flash-alert")},1e3)}function Me(){document.addEventListener("click",t=>{const e=t.target.closest(".case-card");if(e){const s=e.dataset.caseId;if(s){const r=`${l.pwaUrl}#results?display=kiosk&caseId=${s}`;window.location.href=r,m.markViewed(s)}}const n=t.target.closest(".dismiss-case-button");if(n){const s=n.dataset.caseId;s&&B(s)}(t.target.classList.contains("modal-overlay")||t.target.classList.contains("close-modal"))&&_()}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){_();return}if(t.key==="Enter"||t.key===" "){const e=t.target.closest(".case-card");if(e){t.preventDefault();const n=e.dataset.caseId;if(n){const s=`https://igfap.eu/0825/#results?display=kiosk&caseId=${n}`;window.location.href=s,m.markViewed(n)}}}}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&(console.log("[Kiosk] Tab visible - fetching latest cases"),m.fetchCases())}),window.addEventListener("dismissCase",t=>{const e=t.detail?.caseId;e?(console.log("[Kiosk] Received dismissCase event for:",e),B(e)):console.error("[Kiosk] dismissCase event missing caseId")})}async function B(t){const e=m.getCase(t);if(!e){console.warn("[Kiosk] Case not found:",t);return}const n=`Are you sure you want to dismiss this case?

Ambulance: ${e.ambulanceId}
Module: ${e.moduleType}
ICH Risk: ${Math.round((e.results?.ich?.probability||0)*100)}%

This action will archive the case.`;if(!confirm(n)){console.log("[Kiosk] Case dismissal cancelled");return}try{const r=document.querySelector(`[data-case-id="${t}"]`);r&&(r.disabled=!0,r.textContent="Dismissing..."),await m.dismissCase(t),console.log("[Kiosk] Case dismissed successfully:",t),_(),document.body.classList.add("flash-success"),setTimeout(()=>{document.body.classList.remove("flash-success")},500)}catch(r){console.error("[Kiosk] Failed to dismiss case:",r),alert(`Failed to dismiss case:
${r.message}

Please try again or contact support.`);const i=document.querySelector(`[data-case-id="${t}"]`);i&&(i.disabled=!1,i.textContent="üóëÔ∏è Dismiss Case")}}function _(){const t=document.getElementById("caseDetailModal");t&&(t.style.display="none",t.querySelector(".modal-content").innerHTML="")}window.addEventListener("error",t=>{console.error("[Kiosk] Unhandled error:",t.error)});window.addEventListener("unhandledrejection",t=>{console.error("[Kiosk] Unhandled rejection:",t.reason)});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",R):R();window.kioskApp={getCases:()=>v,getStatus:()=>m.getStatus(),refresh:()=>m.fetchCases(),playAlert:()=>F()};
//# sourceMappingURL=index-0b0b5pIS.js.map
